<!DOCTYPE html>
<meta charset=UTF-8>
<title>ダミーさん</title>
<!-- dummysan ver. 2011-10-13 -->
<style>
html { margin: 0; padding: 0 }
body { padding: 1em 50px }
h1 { font-size: 20px }
img { margin-right: 10px }
#rack { direction: rtl; text-align: left }
</style>
<body>
<h1>ダミーさん</h1>
<p><input placeholder="320 240"><button type=button>ダミー画像生成</button></p>

<p id=canvasbox><canvas width=0 height=0></canvas></p>

<p id=rack></p>

<script>
var canvas = document.querySelector('canvas'),
    input = document.querySelector('input'),
    button = document.querySelector('button');


// widthとheightを文字列から抽出する
// return: [ _width_ (int), _height_ (int) ]
var parseInput = function (string) {
  // "320 200", "120,200", "240x80" などにマッチ
  // 所々に空白を許すやさしい仕様
  var re = /^(?:\u0020*)(\d{1,3})(?:\u0020*[\u0020,x]\u0020*)(\d{1,3})(?:\u0020*)$/;
  var result = [];

  // マッチしたら中身を普通の数値に変換
  if (string.match(re)) {
    var arrayParsed = string.match(re).slice(1);
    var i = 0, l = arrayParsed.length;
    for (i; i < l; i++) {
      result[i] = parseInt(arrayParsed[i], 10);
    }
  }
  return result;
}


// ダミー画像の追加
var add = function () {
  // 入力された値を数値として取得
  var parsedInput = parseInput(input.value);
  var inputWidth = parsedInput[0],
      inputHeight = parsedInput[1];
  draw(inputWidth, inputHeight);
}


// ダミー画像の描画
var draw = function (width, height) {
  // 幅と高さをcanvasにセット
  canvas.setAttribute('width', width);
  canvas.setAttribute('height', height);

  var cWidth = canvas.width,
      cHeight = canvas.height;

  // ダミー画像を描画
  var ctx = canvas.getContext('2d');
  ctx.fillStyle = '#bbb';
  ctx.fillRect(0, 0, cWidth, cHeight);

  // 幅が36px以下、テキストAPIが無い場合はここでさよなら
  if (cWidth < 36 || !ctx.fillText) return false;

  // テキストの基本スタイル
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillStyle = '#fff';
  ctx.shadowBlur = 5;
  ctx.shadowColor = '#666';

  // フォントの大きさは幅によって変える
  if (cWidth < 36) {
    ctx.font = '12px Trebuchet MS';
    ctx.shadowBlur = 0;
  }
  else if (cWidth < 76) {
    ctx.font = 'bold 15px Trebuchet MS';
  }
  else {
    ctx.font = 'bold 20px Trebuchet MS';
  }

  // テキストを描画する
  ctx.fillText(cWidth + '×' + cHeight, cWidth/2, cHeight/2);
}

// とりあえず機能するように。
button.addEventListener('click', function(){
  add()
}, false);

</script>
